<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="shortcut icon" href="/img/kurento.png" type="image/png">

<link rel="stylesheet" href="/webjars/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/webjars/ekko-lightbox/dist/ekko-lightbox.min.css">
<link rel="stylesheet" href="/webjars/demo-console/index.css">
<link rel="stylesheet" href="/css/kurento.css">

<script src="/webjars/jquery/dist/jquery.min.js"></script>
<script src="/webjars/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/webjars/demo-console/index.js"></script>
<script src="/webjars/ekko-lightbox/dist/ekko-lightbox.min.js"></script>

<!-- <script src="/webjars/adapter.js/adapter.js"></script> -->
<script src="/webjars/webrtc-adapter/release/adapter.js"></script>

<script src="/js/kurento-utils.js"></script>
<script src="/js/index.js"></script>

<title>Kurento Tutorial: Play an RTP stream</title>
</head>
<body>
  <header>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target=".navbar-collapse"></button>
          <a class="navbar-brand" href=".">Kurento Tutorial</a>
        </div>
        <div class="collapse navbar-collapse"
          id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li><a
              href="https://github.com/Kurento/kurento-tutorial-java/tree/master/kurento-player"><span
                class="glyphicon glyphicon-file"></span> Source Code</a></li>
          </ul>
        </div>
      </div>
    </div>
  </header>
  <div class="container">
    <div class="page-header">
      <h1>Kurento Tutorial: Play an RTP stream</h1>
      <p>
        This web application consists of a simple RTP stream pipeline: a
        <i>RtpEndpoint</i> is configured in KMS to listen for one incoming
        video stream, that will be generated by an external program.
      </p>
      <p>
        Visual feedback is provided in this page, by connecting the
        <i>RtpEndpoint</i> to a <i>WebRtcEndpoint</i> in receive-only mode.
        <br>
        To run this demo follow these steps:
      </p>
      <ol>
        <li>Open this page with a WebRTC-compliant browser (Chrome, Firefox).</li>
        <li>Click on <i>Start</i> to begin the stream negotiation.</li>
        <li>Copy the KMS IP and port information to the external streaming program.</li>
        <li>Click on <i>Stop</i> to finish the playback.</li>
      </ol>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="row">
          <div class="col-md-12">
            <a id="start" href="#" class="btn btn-success">
              <span class="glyphicon glyphicon-play"></span>
              Start
            </a>
            <a id="stop" href="#" class="btn btn-danger">
              <span class="glyphicon glyphicon-stop"></span>
              Stop
            </a>
          </div>
        </div>

        <br> <label class="control-label">KMS port info</label>
        <br>
        <textarea id="msgPortInfo" cols="6">
          No info received yet...
        </textarea>

        <br> <label class="control-label">SDP response</label>
        <br>
        <textarea id="msgSdpText" cols="6">
          No info received yet...
        </textarea>
      </div>

      <div class="col-md-6">
        <div id="videoBig">
          <video id="video" autoplay width="640px" height="480px" poster="img/webrtc.png"></video>
        </div>
      </div>
    </div>

    <div class="row">
      <br>
      <label class="control-label">Sample RTP sender</label>
      <br>
      <p>
        This is a sample GStreamer pipeline command that you can copy and
        paste into a shell. It includes the following features:<br>
        - Sends Audio and Video streams through RTP.<br>
        - Sends RTP and RTCP packets to KMS.<br>
        - Receives and prints Video RTCP packets from KMS.<br>
        - Binds to specific output ports for symmetric RTP/RTCP.<br>
      </p>
      <pre id="gstCommand">
KMS_A={KMS_AUDIO_PORT} KMS_V={KMS_VIDEO_PORT} KMS_IP={KMS_PUBLIC_IP} APP_A=5006 APP_V=5004 bash -c '\
gst-launch-1.0 rtpbin name=r sdes="application/x-rtp-source-sdes,cname=(string)\"user\@example.com\"" \
  filesrc location={PATH_TO_VIDEO} ! decodebin name=d \
  d. ! queue ! audioconvert ! opusenc ! rtpopuspay \
    ! "application/x-rtp,payload=(int)96,clock-rate=(int)48000,ssrc=(uint)445566" \
    ! r.send_rtp_sink_0 \
    r.send_rtp_src_0 ! udpsink host=$KMS_IP port=$KMS_A bind-port=$APP_A \
    r.send_rtcp_src_0 ! udpsink host=$KMS_IP port=$((KMS_A+1)) bind-port=$((APP_A+1)) sync=false async=false \
    udpsrc port=$((APP_A+1)) ! r.recv_rtcp_sink_0 \
  d. ! queue ! videoconvert ! x264enc tune=zerolatency ! rtph264pay \
    ! "application/x-rtp,payload=(int)103,clock-rate=(int)90000,ssrc=(uint)112233" \
    ! r.send_rtp_sink_1 \
    r.send_rtp_src_1 ! udpsink host=$KMS_IP port=$KMS_V bind-port=$APP_V \
    r.send_rtcp_src_1 ! udpsink host=$KMS_IP port=$((KMS_V+1)) bind-port=$((APP_V+1)) sync=false async=false \
  udpsrc port=$((APP_V+1)) ! tee name=t \
    t. ! queue ! fakesink dump=true async=false \
    t. ! queue ! r.recv_rtcp_sink_1'
      </pre>
    </div>

    <div class="row">
      <br> <label class="control-label" for="console">Console</label>
      <br>
      <br>
      <div id="console" class="democonsole" style="height: 250px;">
        <ul></ul>
      </div>
    </div>

  </div>

  <footer>
    <div class="foot-fixed-bottom">
      <div class="container text-center">
        <hr>
        <div class="row">&copy; 2016-2017 Kurento</div>
        <div class="row">
          <div class="col-md-4">
            <a href="http://www.urjc.es"><img src="/img/urjc.gif"
              alt="Universidad Rey Juan Carlos" height="50px"></a>
          </div>
          <div class="col-md-4">
            <a href="http://www.kurento.org"><img src="/img/kurento.png"
              alt="Kurento" height="50px"></a>
          </div>
          <div class="col-md-4">
            <a href="http://www.naevatec.com"><img src="/img/naevatec.png"
              alt="Naevatec" height="50px"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>
