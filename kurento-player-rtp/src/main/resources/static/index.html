<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="expires" content="0">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="shortcut icon" href="/img/kurento.png" type="image/png">

<link rel="stylesheet" href="/webjars/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="/webjars/ekko-lightbox/dist/ekko-lightbox.min.css">
<link rel="stylesheet" href="/webjars/demo-console/index.css">
<link rel="stylesheet" href="/css/kurento.css">

<script src="/webjars/jquery/dist/jquery.min.js"></script>
<script src="/webjars/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/webjars/demo-console/index.js"></script>
<script src="/webjars/ekko-lightbox/dist/ekko-lightbox.min.js"></script>

<!-- <script src="/webjars/adapter.js/adapter.js"></script> -->
<script src="/webjars/webrtc-adapter/release/adapter.js"></script>

<script src="/js/kurento-utils.js"></script>
<script src="/js/index.js"></script>

<title>Kurento Tutorial - RTP Player via WebRTC</title>
</head>
<body>
  <header>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse"
            data-target=".navbar-collapse"></button>
          <a class="navbar-brand" href=".">Kurento Tutorial</a>
        </div>
        <div class="collapse navbar-collapse"
          id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="https://github.com/Kurento/kurento-tutorial-java/tree/master/kurento-player-rtp">
                <span class="glyphicon glyphicon-file"></span> Source Code</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </header>
  <div class="container">
    <div class="page-header">
      <h1>Kurento Tutorial - RTP Player via WebRTC</h1>
      <p>
        This web application consists of a simple RTP stream pipeline: an
        <i>RtpEndpoint</i> is configured in KMS to listen for one incoming
        video stream. This stream must be generated by an external program.
      </p>
      <p>
        Visual feedback is provided in this page, by connecting the
        <i>RtpEndpoint</i> to a <i>WebRtcEndpoint</i> in receive-only mode.
        <br>
        To run this demo follow these steps:
      </p>
      <ol>
        <li>Open this page with a WebRTC-compliant browser (Chrome, Firefox).</li>
        <li>Click on <i>Start</i> to begin the stream negotiation.</li>
        <li>Copy the KMS IP and Port information to the external streaming program.</li>
        <li>Click on <i>Stop</i> to finish the playback.</li>
      </ol>
    </div>
    <div class="row">
      <div class="col-md-6">
        <div class="row">
          <div class="col-md-12">
            <a id="start" href="#" class="btn btn-success">
              <span class="glyphicon glyphicon-play"></span>
              Start
            </a>
            <a id="stop" href="#" class="btn btn-danger">
              <span class="glyphicon glyphicon-stop"></span>
              Stop
            </a>
          </div>
        </div>
        <br>
        <div class="row">
          <input type="checkbox" id="checkcomedia" name="check-comedia">
          <label for="checkcomedia">
            Automatic RTP/RTCP port discovery ("Connection-Oriented Media")
          </label>
        </div>
        <div class="row">
          <input type="checkbox" id="checksrtp" name="check-srtp">
          <label for="checksrtp">Sender uses SRTP</label>
        </div>
        <br>
        <div class="row">
          <label class="control-label">KMS connection info</label>
          <br>
          <textarea id="msgConnInfo">No info received yet...</textarea>
        </div>
        <div class="row">
          <label class="control-label">SDP response</label>
          <br>
          <textarea id="msgSdpText">No info received yet...</textarea>
        </div>
      </div>

      <div class="col-md-6">
        <div id="videoBig">
          <video id="video" autoplay width="640px" height="480px" poster="img/webrtc.png"></video>
        </div>
      </div>
    </div>

    <div class="row">
      <br>
      <label class="control-label">Sample RTP sender</label>
      <br>
      <p>
        This is a sample GStreamer pipeline command that you can copy and
        paste into a shell. It includes the following features:<br>
        - Sends Audio and Video streams through RTP.<br>
        - Sends RTP and RTCP packets to KMS.<br>
        - Receives and prints Video RTCP packets from KMS.<br>
        - Binds to specific output ports for automatic RTP/RTCP port discovery.<br>
      </p>
      <pre id="gstCommand">
DST_A={KMS_AUDIO_PORT} DST_V={KMS_VIDEO_PORT} DST_IP={KMS_PUBLIC_IP} \
SRC_PATH="{PATH_TO_VIDEO_FILE}" \
SRC_A=5006 SRC_V=5004 \
bash -c 'gst-launch-1.0 -e \
  rtpbin name=r sdes="application/x-rtp-source-sdes,cname=(string)\"user\@example.com\"" \
  filesrc location="$SRC_PATH" ! decodebin name=d \
  d. ! queue ! audioconvert ! opusenc \
    ! rtpopuspay ! "application/x-rtp,payload=(int)96,clock-rate=(int)48000,ssrc=(uint)445566" \
    ! r.send_rtp_sink_0 \
  d. ! queue ! videoconvert ! x264enc tune=zerolatency \
    ! rtph264pay ! "application/x-rtp,payload=(int)103,clock-rate=(int)90000,ssrc=(uint)112233" \
    ! r.send_rtp_sink_1 \
  r.send_rtp_src_0 ! udpsink host=$DST_IP port=$DST_A bind-port=$SRC_A \
  r.send_rtcp_src_0 ! udpsink host=$DST_IP port=$((DST_A+1)) bind-port=$((SRC_A+1)) sync=false async=false \
  udpsrc port=$((SRC_A+1)) ! r.recv_rtcp_sink_0 \
  r.send_rtp_src_1 ! udpsink host=$DST_IP port=$DST_V bind-port=$SRC_V \
  r.send_rtcp_src_1 ! udpsink host=$DST_IP port=$((DST_V+1)) bind-port=$((SRC_V+1)) sync=false async=false \
  udpsrc port=$((SRC_V+1)) ! tee name=t \
    t. ! queue ! r.recv_rtcp_sink_1 \
    t. ! queue ! fakesink dump=true async=false'
      </pre>
    </div>

    <div class="row">
      <br>
      <label class="control-label">Sample SRTP sender</label>
      <br>
      <p>
        This is a sample GStreamer pipeline command that you can copy and
        paste into a shell. It includes the following features:<br>
        - Sends a Video stream through SRTP.<br>
        - Sends SRTP and SRTCP packets to KMS.<br>
        - Receives and prints Video SRTCP packets from KMS.<br>
        - Binds to specific output ports for automatic RTP/RTCP port discovery.<br>
      </p>
      <pre id="gstCommand">
DST_V={KMS_VIDEO_PORT} DST_SSRC={KMS_VIDEO_SSRC} DST_IP={KMS_PUBLIC_IP} \
SRC_PATH="{PATH_TO_VIDEO_FILE}" \
SRC=5004 SRC_SSRC=112233 \
SRTP_CAPS="payload=(int)103,ssrc=(uint)$DST_SSRC,roc=(uint)0, \
    srtp-key=(buffer)343332315A595857565554535251504F4E4D4C4B4A494847464544434241, \
    srtp-cipher=(string)aes-128-icm,srtp-auth=(string)hmac-sha1-80, \
    srtcp-cipher=(string)aes-128-icm,srtcp-auth=(string)hmac-sha1-80" \
bash -c 'gst-launch-1.5 -e \
  rtpsession name=r sdes="application/x-rtp-source-sdes,cname=(string)\"user\@example.com\"" \
  srtpenc name=e key="4142434445464748494A4B4C4D4E4F505152535455565758595A31323334" \
    rtp-cipher="aes-128-icm" rtp-auth="hmac-sha1-80" \
    rtcp-cipher="aes-128-icm" rtcp-auth="hmac-sha1-80" \
  srtpdec name=d \
  filesrc location="$SRC_PATH" ! decodebin \
    ! x264enc tune=zerolatency \
    ! rtph264pay ! "application/x-rtp,payload=(int)103,ssrc=(uint)$SRC_SSRC" \
    ! r.send_rtp_sink \
  r.send_rtp_src ! e.rtp_sink_0 \
    e.rtp_src_0 ! udpsink host=$DST_IP port=$DST_V \
  r.send_rtcp_src ! e.rtcp_sink_0 \
    e.rtcp_src_0 ! udpsink host=$DST_IP port=$((DST_V+1)) sync=false async=false \
  udpsrc port=$((SRC+1)) ! "application/x-srtcp,$SRTP_CAPS" ! d.rtcp_sink \
    d.rtcp_src ! tee name=t \
    t. ! queue ! r.recv_rtcp_sink \
    t. ! queue ! fakesink dump=true async=false'
      </pre>
    </div>

    <div class="row">
      <br> <label class="control-label" for="console">Console</label>
      <br>
      <br>
      <div id="console" class="democonsole" style="height: 250px;">
        <ul></ul>
      </div>
    </div>

  </div>

  <footer>
    <div class="foot-fixed-bottom">
      <div class="container text-center">
        <hr>
        <div class="row">&copy; 2016-2017 Kurento</div>
        <div class="row">
          <div class="col-md-4">
            <a href="http://www.urjc.es"><img src="/img/urjc.gif"
              alt="Universidad Rey Juan Carlos" height="50px"></a>
          </div>
          <div class="col-md-4">
            <a href="http://www.kurento.org"><img src="/img/kurento.png"
              alt="Kurento" height="50px"></a>
          </div>
          <div class="col-md-4">
            <a href="http://www.naevatec.com"><img src="/img/naevatec.png"
              alt="Naevatec" height="50px"></a>
          </div>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>
